


# 上线期间兼容问题

上线流程一版是先后端，再前端， 后端会一台台连续发布， 前端会在后端系统发布完成后再一台台的发布。

上线期间会产生兼容性问题， 一般就是在发布每一台后端、前端系统期间产生的。

上线期间兼容问题发生的场景有如下几种：

1. 入参出参变更

底层系统接口入参或者出现定义发生变更，且添加了新的入参判断逻辑， 在底层系统发布过程中，上层系统尚未发布，请求打到该接口上，就会直接把相关的逻辑错误爆出给最终使用人员。如果功能改动是后台管理系统还好，影响范围总体可控。
可如果最终用户是C端或者B端用户，严重的甚至会引发线上事故， 开发人员一定要引以为戒。

相对后边的几种场景而言，入参出参所引发的上线期间兼容问题很容易评估解决。评估方案可以在流程上做出控制：
比如，接口文档中， 每一个接口除了【请求地址】，【请求方法】，【功能描述】，【请求参数】，【入参变更】，【相应参数】，【出参变更】等固定说明外，还需要加上【上线兼容】字段作为评估依据。

解决方案有如下几种：
* 业务允许的话，为入参变更提供默认值；
* HTTP接口有变更，可以协调接口涉及前后端相关人员，重新定义一个接口，这样底层系统发布过程中，上层系统还未发布，请求从前端打到后端，走的始终是老接口，这样老请求的数据在新接口中就不会爆出问题。
* Dubbo RPC 接口，可以不重新定义新的接口，这时候需要升级dubbo 版本。 发布流程是最底层的系统先发布一半， 然后依次向上，上层系统也发布一半， 直到前端系统时，发布所有的前端系统，然后依次向下，把后端系统全部发布完毕。
这样做的目的是，前端发布后的请求，打到新版本的后端接口，未发布的前端系统进来的请求，会打到老版本的后端系统上，保证上线期间的兼容性问题。


2. 缓存数据结构变更

这里讨论的不是缓存数据库不一致的问题，讨论的是缓存数据的序列化问题。

后端系统通常会使用缓存以提升接口性能，并且存储缓存时，有的会直接存储对象，有的会存储protobuff，有的会存储对象转化成json后的字符串。

而所缓存的对象如果数据结构发生变更（通常底层的关系型数据库表结构也会发生变更），比如增加字段， 如果存储的缓存
