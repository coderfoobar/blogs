
# JVM 内存分配与回收策略

> Create Time : 2017年8月3日  Ref : 深入理解Java虚拟机 （周志明）

* 对象优先在Eden区分配 - 当Eden区没有足够的空间进行分配时，虚拟机将进行一次Minor GC
* 大对象直接进入老年代
* 长期存活对象将进入老年代 - 对象在Survivor每熬过一次Minor GC，年龄就增加一岁，当它的年龄增加到一定程度时（默认15），就将会被晋升到老年代中。
* 动态对象年龄绑定 - 如果在Survivor空间中相同年龄的所有对象大小的综合大于Survivor空间的一半，年龄大于或等于该年龄的对象可以直接进入老年代。
* 空间分配担保 - 在发生Minor GC之前，虚拟机会检查老年代最大可用空间是否大于新生代所有对象总空间，如果这个条件成立，那么Minor GC可以确保是安全的。如果不成立，则虚拟机会查看HandlePromotionFailure设置值是否允许担保失败。如果允许，那么会检查老年代最大可用的连续空间是否大于历次晋升到老年代对象的平均大小，如果大于，将尝试着进行一次Minor GC，尽管这次Minor GC是有风险的。如果小于，或者HandlePromotionFailure设置不允许冒险，那这时要改为进行一次Full GC。



