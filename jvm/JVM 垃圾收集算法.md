
# JVM 垃圾回收算法

> Create Time : 2017年8月3日  Ref : 深入理解Java虚拟机 （周志明）

## 标记-清除算法

首先标记所有需要回收的对象，在标记完成收同意回收所有被标记的对象。

主要不足有两个：
* 效率问题，标记和清除两个过程效率都不高。
* 空间问题，标记清除后，内存会产生大量不连续的碎片。

## 复制算法

将内存划分为两块大小相等区域，每次只使用其中的一块，当这一块的内存用完了，就将还活着的想复制到另外一块上面，然后再把已使用过的内存空间一次性清理掉。这样使得每次收是对整个半区进行内存回收，内存分配的时候也不用考虑内存碎片的问题，只需要移动堆顶指针，按顺序分配内存即可，实现简单，运行高效。

只是这种算法将内存缩小为原来的一半，代价未免太高。

现代商业的虚拟机都使用这种搜集算法来回收`新生代`。 新生代98%的对象都是朝生夕死的，可以将内存分为一块较大的Eden空间和两块较小的Survivor空间，每次使用Eden和其中一个Survivor。当回收时，将Eden和Survivor中还活着的对象一次性复制到另外一块Survivor空间上，最后清理掉Eden和刚才使用的Survivor空间。HotSpot虚拟机默认Eden:Survivor的大小比例是8:1，也就是每次新生代中可用空间为整个新生代容量的90%。只有10%的空间会被浪费。

当Survivor空间不够用时，需要依赖其他内存进行分配担保。

如果另外一块Survivor没有足够的空间存放上一次新生代收集下来的存活对象，这些对象将直接通过分配担保机制进入老年代。

## 标记 - 整理算法

根据老年代的特点，有人提出了一种“标记-整理”算法。

标记过程仍然与“标记-清除”算法一样，但是后续步骤不是直接对可回收对象进行清理，而是让所有存活的对象都向一端移动，然后直接清理掉端边界以外的内存。

## 分代收集算法

新生代：复制算法
老年代：标记-整理算法




